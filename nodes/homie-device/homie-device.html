<script type="text/html text/x-red" data-template-name="homie-convention-device">

    <style>
      .homie-ready {
        background-color: rgba(0, 128, 0, 0.2);
      }
      .homie-lost {
        color: #80000;
        background-color: rgba(128, 0, 0, 0.5);
      }
      .homie-sleeping {
        background-color: rgba(0, 0, 128, 0.5);
      }
      .homie-init {
        background-color: rgba(255, 255, 100, 0.5);
      }
      .homie-disconnected {
        background-color: rgba(102, 102, 51, 0.5);
      }
      .homie-alert {
        background-color: rgba(204, 0, 204, 0.5);
      }
      .homie-undefined {
        background-color: rgba(102, 153, 153, 0.5);
      }
      .homie-base {
        background-color: rgba(0, 0, 0, 0.5);
      }
      .homie-node {
        background-color: rgba(0, 0, 0, 0.3);
      }
      .homie-extension {
        font-family: "Helvetica Neue",Arial,Helvetica,sans-serif;
        font-style: italic;
        color: #AAAAAA;
      }
      .homie-property {
        font-family: "Helvetica Neue",Arial,Helvetica,sans-serif;
        font-style: bold;
      }
      .homie-parameter {
        font-family: "Helvetica Neue",Arial,Helvetica,sans-serif;
        font-style: italic;
        color: #AAAAAA;
      }
      .homie-lostFont {
        color: #80000;
      }
      .homie-notReady {
        color: #AAAAAA;
      }
    </style>

    <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
      <label for="node-input-broker"><i class="fa fa-exchange"></i> Broker</label>
      <input id="node-input-broker">
    </div>
    
    <div class="form-row">
      <ul style="min-width: 600px; margin-bottom: 20px;" id="node-config-homie-tabs"></ul>
    </div>

    <div id="node-config-homie-tabs-content" style="min-height: 170px;">

      <div id="homie-tab-homieTree" style="display:none">
        <div class="form-tips" style="height: 65px; max-width: none;" id="node-input-homie-treeList-tips">
          <p>
            Hover over the items to get detailed information.
          </p>
        </div>
        <div class="form-row" style="margin-bottom:0px;">
          <label for="node-input-homieTree" style="width: 50%;"><i class="fa fa-server"></i>&nbsp;homie&nbsp;nodes&nbsp;received&nbsp;from&nbsp;broker</label>
          <input type="hidden" id="node-input-homieTree">
          <span style="float:right">
            <input type="checkbox" id="node-input-filterTree" style="display: inline-block; width: auto; vertical-align: top;">
            <label for="node-input-filterTree">apply&nbsp;filter</label>
            <button id="node-input-clearSelection" class="red-ui-button red-ui-button-small"><i class="fa fa-times"></i>&nbsp;clear&nbsp;selection</button>
            <button id="node-input-refreshTree" class="red-ui-button red-ui-button-small"><i class="fa fa-refresh"></i>&nbsp;update</button>
          </span>
        </div>
        <div class="form-row node-treeList-row-homieTree">
          <div style="height: 200px; min-height:150px;" class="node-homieTree-treeList" id="node-input-homie-homieTree"></div>
        </div>
        <div class="form-row node-homie-data-row"></div>
      </div>

      <div id="homie-tab-basic" style="display:none">
        <div class="form-row">
            <label><i class="fa fa-info-circle"></i> Settable</label>
            <input type="checkbox" id="node-input-settable" style="display: inline-block; width: auto; vertical-align: top;">
            <label for="node-input-settable" style="width: 70%;">&nbsp;&nbsp;<i class="fa fa-clock"></i> show only <code>$settable==true</code> properties.</label>
        </div>
        <div class="form-row">
          <label for="node-input-baseID"><i class="fa fa-database"></i> Base</label>
          <select id="node-input-baseID"></select>
        </div>
        <div class="form-row">
          <label for="node-input-deviceID"><i class="fa fa-microchip"></i> Device</label>
          <select id="node-input-deviceID"></select>
        </div>
        <div class="form-row">
          <label for="node-input-nodeID"><i class="fa fa-tags"></i> Node</label>
          <select id="node-input-nodeID"></select>
        </div>
        <div class="form-row">
          <label for="node-input-propertyID"><i class="fa fa-tag"></i> Property</label>
          <select id="node-input-propertyID"></select>
        </div>
        <div class="form-row">
          <label for="node-input-extensionID"><i class="fa fa-plug"></i> Extension</label>
          <select id="node-input-extensionID"></select>
        </div>
      </div>

      <div id="homie-tab-extra" style="display:none">
        <div class="form-row">
            <label><i class="fa fa-info-circle"></i> Aditional</label>
            <input type="checkbox" id="node-input-infoTiming" style="display: inline-block; width: auto; vertical-align: top;">
            <label for="node-input-infoTiming" style="width: 70%;">&nbsp;&nbsp;<i class="fa fa-clock"></i> include <code>msg.timing</code></label>
        </div>
        <div class="form-row">
            <label>&nbsp</label>
            <input type="checkbox" id="node-input-infoError" style="display: inline-block; width: auto; vertical-align: top;">
            <label for="node-input-infoError" style="width: 70%;">&nbsp;&nbsp;<i class="fa fa-clock"></i> include <code>msg.error</code></label>
        </div>
        <div class="form-row">
            <label>&nbsp</label>
            <input type="checkbox" id="node-input-infoAttributes" style="display: inline-block; width: auto; vertical-align: top;">
            <label for="node-input-infoAttributes" style="width: 70%;">&nbsp;&nbsp;<i class="fa fa-clock"></i> include <code>msg.property</code></label>
        </div>
        <div class="form-row">
            <label>&nbsp</label>
            <input type="checkbox" id="node-input-infoMqtt" style="display: inline-block; width: auto; vertical-align: top;">
            <label for="node-input-infoMqtt" style="width: 70%;">&nbsp;&nbsp;<i class="fa fa-clock"></i> include <code>msg.mqtt</code></label>
        </div>
        <div class="form-row">
          <label>&nbsp</label>
          <input type="checkbox" id="node-input-sendChangesOnly" style="display: inline-block; width: auto; vertical-align: top;">
          <label for="node-input-sendChangesOnly" style="width: 70%;">&nbsp;&nbsp;<i class="fa fa-clock"></i> emit <b>changed values</b> only</label>
        </div>
        <div class="form-row">
          <label for="node-input-blockTimeout"><i class="fa fa-clock-o"></i> Block</label>
          <input type="number" min="0" max="10000" step="100" id="node-input-blockTimeout" style="width: 15%;">
          &nbsp;&nbsp;ms or last message confirmed
        </div>
      </div>
    </div>
  </div>
</script>

<script type="text/javascript">

  // resize editor or treeList to fill the remaining space (one editor per tab!)
  // called by oneditresize & tabs.onchange
  function resizeTabHD (node, elementId) {
    if (!node) return;

    // determine remaining vertical space
    var height = $("#dialog-form").height();
    var formRows = $("#dialog-form>div:not(#node-config-homie-tabs-content)");
    for (let i=0; i<formRows.size(); i++) {
      height -= $(formRows[i]).outerHeight(true);
    }
    
    // resize editors
    if (node.editors && node.editors.hasOwnProperty(elementId)) {
      tabRows = $(`#homie-node-tab-${elementId}>div:not(.node-text-editor-row-${elementId})`);
      for (let i=0; i<tabRows.size(); i++) {
        height -= $(tabRows[i]).outerHeight(true);
      }
      var editorRow = $(`#homie-node-tab-${elementId}>div.node-text-editor-row-${elementId}`);
      height -= (parseInt(editorRow.css("marginTop")) + parseInt(editorRow.css("marginBottom")));
      $(".node-text-editor").css("height",height+"px");
      node.editors[elementId].resize();
    }
    // resize treeLists
    if (node.treeLists && node.treeLists.hasOwnProperty(elementId)) {
      //resize treeList
      tabRows = $(`#homie-tab-${elementId}>div:not(.node-treeList-row-${elementId})`);
      for (let i=0; i<tabRows.size(); i++) {
        height -= $(tabRows[i]).outerHeight(true);
      }
      var editorRow = $(`#homie-tab-${elementId}>div.node-treeList-row-${elementId}`);
      if (editorRow.length>0) {
        height -= (parseInt(editorRow.css("marginTop")) + parseInt(editorRow.css("marginBottom")));
      }
      $(`.red-ui-treeList`).css("height",height+"px");
    }
  }

  // set all tree selections (treeList name, set to true/false)
  function setTreeSelections(node, treeList, selected = false) {

    function setBranchSelection(branch, selected = false) {
      for (let entry of branch) {
        if (entry.hasOwnProperty('selected')) { // only effect entries with having a selected property
          entry.selected=selected;
        }
        if (branch.hasOwnProperty('children')) {
          setBranchSelection(branch.children, selected)
        }
      }
    }

    if (node.treeLists.hasOwnProperty(treeList)) {
      setBranchSelection(node.treeLists[treeList].treeList, selected)
    }
  }

  //create a treeList instance
  function createTreeListHD (treeLists,id) {
    var node = this;
    if (!treeLists.hasOwnProperty(id)) {
      treeLists[id]={tempSelection:{}};
    }
    treeLists[id].treeList = $("<div>")
      .css({width: "100%", height: "250px"})
      .appendTo(".node-"+id+"-treeList")
      .treeList({})
      .on('treelistitemmouseover',function(e,item) {
        if (item.info) {
          $("#node-input-homie-treeList-tips").html(item.info)
        }
      })
      .on('treelistselect', function(event, item) {
        var selections = treeLists[id].tempSelection;
        if (selections && item.id && item.id!=='') {
          selections[item.id]={selected:item.selected};
        }
      });
    treeLists[id].treeList.treeList('data',[{label:"empty"}]);
  }

  // merge selections into treeList data
  function updateTreeListHD(data, selections) {
    
    // expandTree upwards
    function expandTree (dataRoot) {
      
      function expandBranch(subChild) {
        let result;
        for (let entry of subChild) {
          if (entry.hasOwnProperty('children')) {
            if (expandBranch(entry.children)) {
              entry.expanded=true;
              result = true; // to be sent to grandparent
            }
          }
          if (entry.selected) {
            result = true; // to be sent to parent
          }
        }
        return result;
      }

      expandBranch(dataRoot);
    }
    
    // check branches if they contain selected ids
    function checkBranch (branchData) {
      for (var index in branchData) {
        if (selections.hasOwnProperty(branchData[index].id) && selections[branchData[index].id].selected) {
          branchData[index].selected = true;
        }
        if (branchData[index].hasOwnProperty('children')) {
          checkBranch(branchData[index].children, selections);
        }
      }
    }

    checkBranch(data);
    expandTree(data);
  }

  // remember last selection to prevent unnecessary Updates
  var lastBaseID = '';
  var lastDeviceID = '';
  var lastNodeID = '';
  var lastPropertyID = '';

	function configEditPrepare(node, allowEmpty) {

    function setColourPickerColour(id, val, ed) {
                  $("#"+id).val(val);
                  $("#"+id).css("background-color", val);
              }

    function updateTreeList(node) {
      if (!node.treeLists['homieTree'].updated) {
        var cntrlConfig = RED.nodes.node($('#node-input-broker').val());
        if ( cntrlConfig ) {
          var config = {
            name: cntrlConfig.name,
            broker: cntrlConfig.id,
            baseId: $('#node-input-baseID').val() || node.baseID,
            deviceId: $('#node-input-deviceID').val() || node.deviceID,
            nodeId: $('#node-input-nodeID').val() || node.nodeID,
            propertyId: $('#node-input-propertyID').val() || node.propertyID,
            extensionId: $('#node-input-extensionID').val() || node.extensionID,
            filterTree: $('#node-input-filterTree').is(':checked')
          }
          node.treeLists['homieTree'].updated=true;
          $.getJSON("homieConvention/treeList", config)
            .done( function(data) {
              console.log('updateTreeList',data);
              if (!$('#node-input-filterTree').is(':checked')) {
                updateTreeListHD(data,node.treeLists['homieTree'].tempSelection)
              }
              node.treeLists['homieTree'].treeList.treeList('data',data);
            })
            .fail(function(e1, e2, e3) {
              node.treeLists['homieTree'].updated=false;
              console.log("error : " + JSON.stringify(e1));
            });
          }
      }
    }

    function updateItemSelection(valueID, value) {
      var itemSelectionEl = $('#node-input-'+ valueID);
      var treeData = [];  
      var cntrlConfig = RED.nodes.node($('#node-input-broker').val());
      if ( cntrlConfig ) {
        var config = {
          name: cntrlConfig.name,
          broker: cntrlConfig.id,
          // field name to query
          itemID: valueID,
          // filters to query
          baseID: $('#node-input-baseID').val() || node.baseID,
          deviceID: $('#node-input-deviceID').val() || node.deviceID,
          nodeID: $('#node-input-nodeID').val() || node.nodeID,
          propertyID: $('#node-input-propertyID').val() || node.propertyID,
          extensionID: $('#node-input-extensionID').val() || node.extensionID,
          addLabel: $('#node-input-addLabel').val() || node.addLabel,
          settable: $('#node-input-settable').is(':checked')
        }
        /*
        console.log("updateItemSelection ("+valueID+"="+value+") = ",config);
        console.log(" baseID  : ",$('#node-input-baseID').val());
        console.log(" deviceID  : ",$('#node-input-deviceID').val());
        console.log(" nodeID    : ",$('#node-input-nodeID').val());
        console.log(" propertyID: ",$('#node-input-propertyID').val());
        console.log(" settable  : ",$('#node-input-settable').is(':checked'));
        */
        $.getJSON("homieConvention/deviceList", config)
          .done( function(data) {
            console.log(config.itemID,data);
            var items = data;
            if (config.itemID!="treeList") { // fill dropdown list except for treeView updates
              itemSelectionEl.children().remove();
              if (allowEmpty && !(config.settable && valueID=='propertyID')) { // only add [any] wildcard if settable filter is not selected and property list is updating
                itemSelectionEl.append('<option value="[any]">[any]</option>');
              }
              if (valueID=='propertyID' || valueID=='extensionID') {
                itemSelectionEl.append('<option value="[none]">[none]</option>');
              }
              items.forEach(function (item) {
                itemSelectionEl.append('<option value="'+item+'">' + item + '</option>');
              });
              console.log(valueID,$('#node-input-'+valueID).val() || node[valueID],value);
              if (!items.includes(node[valueID])) node[valueID]='[any]';
              itemSelectionEl.val(node[valueID]);
            } else { // fill treeList with selected properties
              treeList.treeList('data',items);
            }
          })
          .fail(function(e1, e2, e3) {
            console.log("error : " + JSON.stringify(e1));
          });
      } else console.log("Ups, no broker config!:",cntrlConfig);
    }

    $('#node-input-filterTree').on("click",function() { // apply filter toggled
      node.treeLists['homieTree'].updated=false;
      updateTreeList(node);
    });

    $('#node-input-refreshTree').on("click",function() { // reload Homie Tree
      node.treeLists['homieTree'].updated=false;
      updateTreeList(node);
    });

    $('#node-input-clearSelection').on("click",function() { // reload Homie Tree
      node.treeLists['homieTree'].tempSelection={};
      node.treeLists['homieTree'].updated=false;
      updateTreeList(node);
    });

    $('#node-input-broker').change(function(ev) { // update device list if broker is changed (nodes and properties should update subsequently)
      updateItemSelection('baseID', $('#node-input-baseID').val() || node.baseID);
      updateTreeList(node);
    });
		$('#node-input-baseID').change(function(ev) {
      updateItemSelection('deviceID', $('#node-input-deviceID').val() || node.deviceID);
      // lastBaseID=$('#node-input-baseID').val();
		});
		$('#node-input-deviceID').change(function(ev) {
      updateItemSelection('nodeID', $('#node-input-nodeID').val() || node.nodeID);
      if ($('#node-input-nodeID').val()=="[any]"){ // update property list if any node selected
        updateItemSelection('propertyID', $('#node-input-propertyID').val() || node.propertyID);
        updateItemSelection('extensionID', $('#node-input-extensionID').val() || node.extensionID);
      }
      if (lastDeviceID!=$('#node-input-deviceID').val()) { // update tree List if Device ID differs.
        // updateItemSelection('treeList', $('#node-input-propertyID').val() || node.propertyID);
      }
      // lastDeviceID=$('#node-input-deviceID').val();
		});
		$('#node-input-nodeID').change(function(ev) { // update property List if node changes
      updateItemSelection('propertyID', $('#node-input-propertyID').val() || node.propertyID);
      updateItemSelection('extensionID', $('#node-input-extensionID').val() || node.extensionID);
      //lastNodeID=$('#node-input-nodeID').val();
    });
    $('#node-input-propertyID').change(function(ev) { // update property List if property selected
      // updateItemSelection('treeList', $('#node-input-propertyID').val() || node.propertyID);
      // lastPropertyID=$('#node-input-propertyID').val();
    });
    $('#node-input-settable').on("click",function() { // re-update property list if $settable filter setting is changed
      updateItemSelection('propertyID', $('#node-input-propertyID').val() || node.propertyID);
    });
	}

  // register homie-convention-device
  var currentUITab = "";

  RED.nodes.registerType('homie-convention-device', {
    category: 'Homie convention',
    paletteLabel: 'Homie device',
    label: 'Homie device',
    color: '#AA2517',
    defaults: {
      broker: {value: '', type: 'homie-convention-broker-config', required: true},
      name: {value: ''},
      baseID: {value: '[any]', required: true},
      deviceID: {value: '[any]', required: true},
      nodeID: {value: '[any]', required: true},
      propertyID: {value: '[none]', required: true},
      extensionID: {value: '[none]', required: true},
      selectedNodes: {value: {}},
      topic: {value: ''},
      infoAttributes: {value: true},
      infoTiming: {value: true},
      infoMqtt: {value: true},
      infoError: {value: true},
      sendChangesOnly: {value: false},
      blockTimeout: {value: 0},
      addLabel: {value: 'none'},
      labelTopic: {value: false},
      labelPayload: {value: true},
      labelName: {value: ''},
      settable: {value: false},
      filterTree: {value: false}
    },
    inputs: 1,
    outputs: 2,
    icon: "Homie-device-logo.svg",
    label: function() {
      if (this.filterTree) {
        this.topic= this.baseID;
        this.topic += '/'+this.deviceID;
        this.topic += '/'+this.nodeID;
        this.topic += '/'+this.propertyID;
        return this.name||this.topic||"homie itemp";
      } else {
        let nodes = [];
        Object.keys(this.selectedNodes).forEach(node => {
          if (this.selectedNodes[node].selected) {
            nodes.push(node);
          }
        });
        if (nodes.length===0) {
          return "no properties selected";
        }
        if (nodes.length===1) {
          return nodes[0];
        }
        return `${nodes.length} properties`;
      }
    },
    oneditprepare: function() {
      let node = this;
      node.editors={};
      node.treeLists={};

      createTreeListHD(node.treeLists,"homieTree");
      Object.assign(node.treeLists['homieTree'].tempSelection,node.selectedNodes);

      node.tabs = RED.tabs.create({
        id: "node-config-homie-tabs",
          onchange: function(tab) {
              $("#node-config-homie-tabs-content").children().hide();
              $("#" + tab.id).show();
              currentUITab= tab.id.split('-')[2];
              resizeTabHD(tab.node,currentUITab);
          }
      });     
      node.tabs.addTab({
        id: "homie-tab-homieTree",
        node: this,
        label: this._("homie tree")
      });
      node.tabs.addTab({
        id: "homie-tab-basic",
        node: this,
        label: this._("filter")
      });
      node.tabs.addTab({
        id: "homie-tab-extra",
        node: this,
        label: this._("extra")
      });
      
      var brokerNodeId = $("#node-input-broker").val();
      if (!brokerNodeId) {
        return; // No config node has been specified, so no use to connect to the server ...
      }
      configEditPrepare(this, true);
      setTimeout(function() { node.tabs.resize(); },0);
    },
    oneditsave: function() { 
      let node = this;
      for (let editorId in node.editors) {
        $("#node-input-"+editorId).val(node.editors[editorId].getValue());
        node.editors[editorId].destroy();
        delete node.editors[editorId];
      }
      // save tempSelection
      if (node.treeLists.hasOwnProperty('homieTree') && node.treeLists.homieTree.hasOwnProperty('tempSelection')) {
        node.selectedNodes={};
        Object.keys(node.treeLists.homieTree.tempSelection).forEach(item => {
          if (node.treeLists.homieTree.tempSelection[item].selected) {
            node.selectedNodes[item]={selected : true};
          }
        })
      }
    },
    oneditcancel: function() {
      let node = this;
      for (let editorId in node.editors) {
        node.editors[editorId].destroy();
        delete node.editors[editorId];
      }
    },
    oneditresize: function(size) {
      let node = this;
      resizeTabHD(node,currentUITab);
    }
  });
</script>

<script type="text/html text/x-red" data-help-name="homie-convention-device">
  <p> 
    <a href="https://homieiot.github.io/">
      <img src="https://homieiot.github.io/img/works-with-homie.png" alt="works with MQTT Homie">
    </a>
  </p>
  <p>
    A message is emitted when a specific message for a homie device, node or property arrives including property information.
    Use the input to send messages to <i>settable</i> properties. 
  </p>
  <p></p>
	<b>Configuration</b>
    <ul>
        <li><b>Name :</b> Optionally specify a name</li>
        <li><b>Broker :</b> Select the mqtt broker where your device is sending messages to.</li>
    </ul>

  <h3>homie tree</h3>
    <p>
      All available homie nodes are shown as a collapsible tree view. Select the properties you like to get updates emitted. All sub branches will be emitted.
    </p>
    <ul>
      <li><b>apply filter :</b> Use filer set on the filter tab instead of individual selected properties.</li>
      <li><b>clear selection :</b> clear all selections to easily start over</li>
      <li><b>update :</b> read latest set of nodes from Node-RED server .</li>
    </ul>

  <h3>filter</h3>
    <p>
        The data emitted by the node can be determined by filters instead picking single properties.
    </p>
    <ul>
       <li><b>base :</b> select one particular or any base nodes</li>
       <li><b>device :</b> select one particular or any device by name</li>
       <li><b>node :</b> select one particular or any node by name</li>
       <li><b>property :</b> select one particular or any property by name</li>
       <li><b>extension :</b> select one particular or any property provided by extensions</li>
    </ul>
  <h3>extra configuration</h3>
    <p>
        Additional information like timing, errors and attributes can be added to the msg object
    </p>
    <ul>
        <li><b>msg.timing :</b> Select to receive timing information.</li>
        <li><b>msg.error :</b> Select to receive error information. Errors always will be sent on 2nd output</li>
        <li><b>msg.property :</b> Select to receive attributes information.</li>
        <li><b>msg.mqtt :</b> Select to receive additional mqtt information.</li>
        <li><b>changed values only :</b> Select to receive data only if it differs from previous.</li>
        <li><b>block new values until confirmed :</b> >0ms to block sending new messages until the last message is confirmed or timeout reached. 
            Latest update is stored and will be sent after confirmation or timeout.
            This feature is useful to limit sending frequent updates synced to device capabilities and not filling the queue on the broker.</li>
   	 </ul>
	<p></p>

  <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">number | string</span>
        </dt>
        <dd> the payload of the message to send to the homie device. </dd>
        <dt class="optional">topic <span class="property-type">string</span></dt>
        <dd> the homie topic to publish to. This can override the node configuration. If empty the node settings will be used. If not matching a known property topic will be ignored.</dd>
    </dl>

 <h3>Outputs</h3>
     <ol class="node-ports">
         <li>Standard output
             <dl class="message-properties">
                 <dt>msg.payload <span class="property-type">string</span></dt>
                 <dd>unaltered message form the device.</dd>

                 <dt>msg.value <span class="property-type">string | number</span></dt>
                 <dd>the standard output of a sucsessfull received update. Depending on the datatype as a String or number.</dd>

                 <dt>msg.setflag <span class="property-type">boolean</span></dt>
                 <dd>true if data was received by a <b>/set</b> message</dd>

                 <dt>msg.predicted <span class="property-type">boolean</span></dt>
                 <dd>true if data not confirmed by the device</dd>

                 <dt>msg.topic <span class="property-type">string</span></dt>
                 <dd>Topic of the value: baseID/deviceID/nodeID/propertyID.</dd>

                 <dt>msg.device <span class="property-type">object</span></dt>
                 <dd>Detailed information of the device</dd>

                 <dt>msg.node <span class="property-type">object</span></dt>
                 <dd>Detailed information of the node</dd>

                 <dt>msg.property <span class="property-type">object</span></dt>
                 <dd>Detailed information of the property</dd>

             </dl>
         </li>
         <li>Standard error
             <dl class="message-properties">
                 <dt>payload <span class="property-type">object</span></dt>
                 <dd>the standard error of the command.</dd>
             </dl>
         </li>
     </ol>

  <h3>Details</h3>
    <p>
        The Homie convention defines a standardized way of how IoT devices and services announce themselves and their data on the MQTT broker.<br>
        It is thereby a crucial aspect on top of the MQTT protocol for <i>automatic discovery, configuration</i> and <i>usage</i> of devices and services.<br>
        Form more Information head over to <a href="https://homieiot.github.io/">https://homieiot.github.io/</a>
    </p>  

  <h3>References</h3>
    <ul>
        <li><a href="https://homieiot.github.io/">Homie Convention</a> - full specification of the Homie Convention</li>
        <li><a href="https://github.com/Christian-Me/node-red-contrib-homie-convention">GitHub</a> - the nodes github repository</li>
    </ul>
</script>
